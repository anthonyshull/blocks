defmodule MbtaMetro.Components.ModeSelector do
  use Phoenix.Component

  attr :field, Phoenix.HTML.FormField,
    doc: "A form field struct retrieved from the form, for example: @form[:modes_to_show]"

  attr :modes, :list,
    default: [
      {"Subway", :subway},
      {"Commuter Rail", :commuter_rail},
      {"Bus", :bus},
      {"Ferry", :ferry}
    ],
    doc: """
    A list of label-value tuples.
    """

  @doc """
  Select one or more modes of transit in a very visual way.
  """
  def mode_selector(assigns) do
    assigns =
      assigns
      |> assign(field: nil, id: assigns.field.id)
      |> assign_new(:name, fn -> assigns.field.name <> "[]" end)
      |> assign_new(:value, fn -> assigns.field.value end)

    ~H"""
    <div class="flex flex-col gap-1">
      <input type="hidden" name={@name} value="" checked={@value == []} />
      <label
        :for={{mode_name, mode_value} <- @modes}
        for={@id <> "_#{mode_value}"}
        class="rounded border-solid border-2 border-transparent has-[:checked]:bg-slate-100 has-[:checked]:font-semibold has-[:focus-within]:border-slate-400
      py-1 px-2 mb-0 inline-flex items-center gap-2"
      >
        <div class="relative">
          <input
            id={@id <> "_#{mode_value}"}
            type="checkbox"
            class="peer sr-only"
            name={@name}
            value={mode_value}
            checked={if(@value, do: mode_value in @value || "#{mode_value}" in @value)}
          />
          <div class="h-8 overflow-hidden rounded-full border-2 border-solid border-slate-200 bg-slate-100 w-14 peer-checked:border-slate-400 peer-checked:bg-slate-300">
          </div>
          <div class="absolute w-6 h-6 rounded-full shadow-lg shadow-indigo-500/40 left-1 top-1 transition opacity-50 peer-checked:translate-x-full peer-checked:opacity-100">
            <%= mode_icon(%{mode: mode_value}) %>
          </div>
        </div>
        <%= mode_name %>
      </label>
    </div>
    """
  end

  defp mode_icon(%{mode: :commuter_rail} = assigns),
    do: ~H"""
    <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16">
      <path
        fill="#80276c"
        d="m6.19 11.91998h3.63v1h-3.63z"
        transform="matrix(.99919448 .0401297 -.0401297 .99919448 .50486 -.31123)"
      />
      <path
        fill="#80276c"
        d="m8 0a8.02127 8.02127 0 0 0 -7.65785 10.376 7.78359 7.78359 0 0 0 5.28185 5.28185 8.008 8.008 0 1 0 2.376-15.65785"
      />
      <g fill="#fff">
        <path d="m10.33 11.75 1.15-.85a1.46975 1.46975 0 0 0 .52-.84v-4.82a.88891.88891 0 0 0 -.3-.66.79321.79321 0 0 1 -.31-.6l-.01-1.19a.81979.81979 0 0 0 -.65-.79 20.91806 20.91806 0 0 0 -2.5-.52 1.06538 1.06538 0 0 0 -.47 0c-.7.15-1.55.3-2.24.48-.42.12-.85.35-.85.85v1.18a.80288.80288 0 0 1 -.33.61.851.851 0 0 0 -.31.66v4.8a1.40971 1.40971 0 0 0 .48.84l1.1.81-1.74 2.84h1.13l.24-.39h5.53l.13.22.02.03.08.14h1.05zm.95-2.3a.73.73 0 1 1 -.73-.73.72767.72767 0 0 1 .73.73zm-1.44 3.15h-3.65l.41-.68h2.84l.03.06.35.58zm-1.14-9.65a.24471.24471 0 0 1 .3-.24l1.21.25a.25351.25351 0 0 1 .2.24v.73a.24955.24955 0 0 1 -.3.24l-1.21-.24a.23758.23758 0 0 1 -.2-.24zm-.72 2.26a.82.82 0 1 1 -.82.82.82371.82371 0 0 1 .82-.82zm-2.32-2.01a.25358.25358 0 0 1 .2-.24l1.21-.25a.24868.24868 0 0 1 .3.24v.74a.24683.24683 0 0 1 -.2.24l-1.22.24a.24554.24554 0 0 1 -.29-.24zm-.2 6.98a.73.73 0 1 1 .73-.73.72767.72767 0 0 1 -.73.73zm0 3.61.5-.82h4.1l.49.82z" />
        <path d="m11 14.55h-.01l-.07-.14z" />
      </g>
    </svg>
    """

  defp mode_icon(%{mode: :subway} = assigns),
    do: ~H"""
    <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16">
      <path fill="#494f5b" d="m8 0a8 8 0 1 0 8 8 8 8 0 0 0 -8-8" />
      <g fill="#fff">
        <path d="m6.67 1.41a.56974.56974 0 0 1 .57-.57.58.58 0 1 1 0 1.16h-.02a.57707.57707 0 0 1 -.55-.59z" />
        <path d="m12.01 9.84v-5.91a1.43829 1.43829 0 0 0 -1.44-1.43h-5.13a1.42971 1.42971 0 0 0 -1.43 1.43v5.9a1.88 1.88 0 0 0 1.53 1.85l-1.54 2.32h1.02l1.26-1.84h3.46l1.26 1.84h1l-1.54-2.32a1.8774 1.8774 0 0 0 1.55-1.84zm-5.01-6.93h2v.84h-2zm-.58 8.3a.77.77 0 1 1 .77-.77.77027.77027 0 0 1 -.77.77zm3.15 0a.77.77 0 1 1 0-1.54.77.77 0 1 1 0 1.54zm1.44-4.71a.52279.52279 0 0 1 -.52.52h-4.96a.51641.51641 0 0 1 -.52-.52v-1.96a.51646.51646 0 0 1 .52-.52h4.96a.52284.52284 0 0 1 .52.52z" />
        <path d="m8.19 1.41a.57841.57841 0 0 1 .58-.57.56974.56974 0 0 1 .57.57.57438.57438 0 0 1 -.57.59.58266.58266 0 0 1 -.58-.59z" />
      </g>
    </svg>
    """

  defp mode_icon(%{mode: :bus} = assigns),
    do: ~H"""
    <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16">
      <path fill="#ffc72c" d="m8.03494 0a8.04088 8.04088 0 0 0 -8 8 8 8 0 1 0 8-8" />
      <path
        fill="#1c1e23"
        d="m12.55163 6.95515-.43927-3.29782c-.11487-.59469-.50684-.83119-1.088-1.07447a9.94811 9.94811 0 0 0 -2.99371-.52036 9.94139 9.94139 0 0 0 -2.98694.52036c-.57444.24328-.97312.47978-1.09476 1.07447l-.43251 3.29782v4.55476h.80756v.77716a.56688.56688 0 0 0 .29735.48655c.04054.02029.08109.04054.11487.05407a.689.689 0 0 0 .09462.027.57561.57561 0 0 0 .15546.02029h.2297a.63557.63557 0 0 0 .669-.58793v-.77716h4.363v.77716a.56686.56686 0 0 0 .29735.48655c.04054.02029.08109.04054.11487.05407a.689.689 0 0 0 .09462.027.57561.57561 0 0 0 .15546.02029h.22974a.63556.63556 0 0 0 .669-.58793v-.77716h.74252zm-6.64292-3.93953h4.25065c.20273 0 .37167.23083.37167.50782s-.16894.50781-.37167.50781h-4.25065c-.20272 0-.37167-.23083-.37167-.50781s.16896-.50782.37167-.50782zm-1.03959 4.55438.3006-2.33388a.31412.31412 0 0 1 .32228-.26712h5.12466a.31832.31832 0 0 1 .32226.26712l.34393 2.33388v.10421a.32557.32557 0 0 1 -.3223.32579h-5.7811a.3317.3317 0 0 1 -.31033-.3388.23335.23335 0 0 1 0-.0912zm.6465 2.75347a.82854.82854 0 1 1 -.03709-1.65432.83107.83107 0 1 1 .03709 1.65432zm5.01541 0a.82854.82854 0 1 1 -.03709-1.65432.83107.83107 0 1 1 .03709 1.65432z"
      />
    </svg>
    """

  defp mode_icon(%{mode: :ferry} = assigns),
    do: ~H"""
    <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16">
      <path
        fill="#008eaa"
        d="m14.14 13.11v-2.78h-1.54v4.21a.00976.00976 0 0 1 -.00995.01 7.96744 7.96744 0 0 1 -9.18005-.01c-.07995-.06-.16-.11-.24-.18l-1.53-1.52a7.91568 7.91568 0 0 1 -1.64-4.84 8 8 0 0 1 16 0 7.8954 7.8954 0 0 1 -1.86 5.11z"
      />
      <path
        fill="#008eaa"
        d="m14.14 10.33v2.78a2.33839 2.33839 0 0 1 -.29.35 7.5757 7.5757 0 0 1 -1.25 1.08v-4.21z"
      />
      <g fill="#fff">
        <path d="m12.6 13.07v1.1a.81712.81712 0 0 1 -.19-.09 1.08477 1.08477 0 0 0 -1.15-.03 1.327 1.327 0 0 1 -1.36.03 1.1128 1.1128 0 0 0 -1.19-.04 1.457 1.457 0 0 1 -1.43 0 1.09284 1.09284 0 0 0 -1.19.04 1.30468 1.30468 0 0 1 -1.36-.04 1.12472 1.12472 0 0 0 -1.16.04.25063.25063 0 0 0 -.07.04v-1.09a.07583.07583 0 0 0 .04-.02 1.22855 1.22855 0 0 1 1.4.08 1.37912 1.37912 0 0 0 1.19-.07 1.18568 1.18568 0 0 1 1.29.04 1.31353 1.31353 0 0 0 1.16 0 1.186 1.186 0 0 1 1.29-.04 1.38316 1.38316 0 0 0 1.19.07 1.24661 1.24661 0 0 1 1.4-.08.351.351 0 0 0 .14.06z" />
        <path d="m11.06 10.98a.87762.87762 0 0 1 -.15.05 3.51709 3.51709 0 0 1 -.16-1.49 10.81375 10.81375 0 0 1 1.85-2.66l-.6-.24v-3.64h-1v-1h-1.99v.01h-.01v-.01h.01v-.99h-2v.99h-2.01v1h-1v3.64l-.59.24a10.46678 10.46678 0 0 1 1.83 2.64 3.75072 3.75072 0 0 1 -.15 1.5.41845.41845 0 0 1 -.15-.04 1.2264 1.2264 0 0 0 -1.4-.07c-.00995.01-.03.01-.04.02v1.08c.02-.01.05-.03.07-.04a1.10228 1.10228 0 0 1 1.16-.03 1.32675 1.32675 0 0 0 1.36.03 1.09231 1.09231 0 0 1 1.19-.03 1.457 1.457 0 0 0 1.43 0 1.09273 1.09273 0 0 1 1.19.04 1.32768 1.32768 0 0 0 1.36-.04 1.12876 1.12876 0 0 1 1.15.03 1.73655 1.73655 0 0 0 .19.1v-1.1a.4229.4229 0 0 1 -.14-.06 1.26247 1.26247 0 0 0 -1.4.07zm-3.06-8.98h.01v.01h-.01zm2.01 3.84v-.84h-1.01v-1h-2v1h-1v.84l-1 .4v-2.24h1v-1h4v1h1v2.24z" />
        <path d="m8 2h.01001v.01001h-.01001z" />
        <path d="m9 2h.01001v.01001h-.01001z" />
        <path d="m8 2h.01001v.01001h-.01001z" />
        <path d="m9 2h.01001v.01001h-.01001z" />
      </g>
    </svg>
    """
end
